<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spjzweb.dao.ThreadInspectionRecordDao">


    <select id="getCountAllByLike" resultType="int">
        select count(*) from thread_inspection_record r
        <where>
            <if test="contract_no!=null and contract_no!=''">
                AND r.contract_no LIKE CONCAT('%',#{contract_no},'%')
            </if>
            <if test="couping_no!=null and couping_no!=''">
                AND r.couping_no LIKE CONCAT('%',#{couping_no},'%')
            </if>
            <if test="operator_no!=null and operator_no!=''">
                AND r.operator_no LIKE CONCAT('%',#{operator_no},'%')
            </if>
            <if test="begin_time!=null">
                <![CDATA[ AND DATE_FORMAT(r.inspection_time,'%Y-%m-%d %H:%T:%s')>=DATE_FORMAT(#{begin_time},'%Y-%m-%d 00:00:00')]]>
            </if>
            <if test="end_time!=null">
                <![CDATA[ AND DATE_FORMAT(r.inspection_time,'%Y-%m-%d %H:%T:%s')<=DATE_FORMAT(#{end_time},'%Y-%m-%d 23:59:59')]]>
            </if>
        </where>
    </select>

    <select id="getAllByLike" resultType="map">
        select * from  thread_inspection_record r
        <where>
            <if test="contract_no!=null and contract_no!=''">
                AND r.contract_no LIKE CONCAT('%',#{contract_no},'%')
            </if>
            <if test="couping_no!=null and couping_no!=''">
                AND r.couping_no LIKE CONCAT('%',#{couping_no},'%')
            </if>
            <if test="operator_no!=null and operator_no!=''">
                AND r.operator_no LIKE CONCAT('%',#{operator_no},'%')
            </if>
            <if test="begin_time!=null">
                <![CDATA[ AND DATE_FORMAT(r.inspection_time,'%Y-%m-%d %H:%T:%s')>=DATE_FORMAT(#{begin_time},'%Y-%m-%d 00:00:00')]]>
            </if>
            <if test="end_time!=null">
                <![CDATA[ AND DATE_FORMAT(r.inspection_time,'%Y-%m-%d %H:%T:%s')<=DATE_FORMAT(#{end_time},'%Y-%m-%d 23:59:59')]]>
            </if>
        </where>
        ORDER BY id DESC
        limit #{skip},#{take}
    </select>


    <select id="getThreadInspectionRecordByInspectionRecordCode" resultType="map">
        select * from  thread_inspection_record r inner join item_record ir on ir.thread_inspection_record_code=r.thread_inspection_record_code
        <where>
            <if test="thread_inspection_record_code!=null and thread_inspection_record_code!=''">
                AND r.thread_inspection_record_code =#{thread_inspection_record_code}
            </if>
        </where>
    </select>


    <insert id="addThreadInspectionRecord" parameterType="com.spjzweb.entity.ThreadInspectionRecord">
        INSERT INTO thread_inspection_record(thread_inspection_record_code,couping_no,contract_no,production_line,machine_no,process_no,operator_no,production_crew,production_shift,video_no,inspection_time,inspection_result) VALUES (#{thread_inspection_record_code},#{couping_no},#{contract_no},#{production_line},#{machine_no},#{process_no},#{operator_no},#{production_crew},#{production_shift},#{video_no},#{inspection_time},#{inspection_result})
    </insert>

    <update id="updateThreadInspectionRecord" parameterType="com.spjzweb.entity.ThreadInspectionRecord">
        UPDATE thread_inspection_record set thread_inspection_record_code=#{thread_inspection_record_code},couping_no=#{couping_no},contract_no=#{contract_no},production_line=#{production_line},machine_no=#{machine_no},process_no=#{process_no},operator_no=#{operator_no},production_crew=#{production_crew},production_shift=#{production_shift},video_no=#{video_no},inspection_time=#{inspection_time},inspection_result=#{inspection_result} where id=#{id}
    </update>


    <delete id="delThreadInspectionRecord">
        delete from thread_inspection_record WHERE
        <foreach collection="array" item="item" open="id in (" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <select id="getThreadInspectionRecordOfWinform" resultType="com.spjzweb.entity.ThreadInspectionRecord">
            select o.* from thread_inspection_record  o where o.contract_no in
            (
               select contract_no from contract_info  r
               <where>
                   <if test="od!=0">
                       AND r.od =#{od}
                   </if>
                   <if test="wt!=0">
                       AND r.wt =#{wt}
                   </if>
                   <if test="threading_type!=null and threading_type!=''">
                       AND r.threading_type =#{threading_type}
                   </if>
                   <if test="thread_inspection_record_code!=null and thread_inspection_record_code!=''">
                       AND r.thread_acceptance_criteria_no =#{thread_inspection_record_code}
                   </if>
               </where>
            )
            limit 10000
    </select>
    <select id="getThreadInspectionRecordByNo" resultType="com.spjzweb.entity.ThreadInspectionRecord">
        SELECT * from thread_inspection_record where thread_inspection_record_code=#{thread_inspection_record_code}
    </select>
    <update id="updateThreadInspectionRecordByCode" parameterType="com.spjzweb.entity.ThreadInspectionRecord">
               UPDATE thread_inspection_record set couping_no=#{couping_no},contract_no=#{contract_no},production_line=#{production_line},machine_no=#{machine_no},process_no=#{process_no},operator_no=#{operator_no},production_crew=#{production_crew},production_shift=#{production_shift},video_no=#{video_no},inspection_time=#{inspection_time},inspection_result=#{inspection_result} where thread_inspection_record_code=#{thread_inspection_record_code}
    </update>
</mapper>