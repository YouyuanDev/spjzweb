<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spjzweb.dao.DynamicMeasurementItemDao">


    <select id="getCountAllByLike" resultType="int">
        select count(*) from dynamic_measurement_item r
        <where>
            <if test="measure_item_code!=null and measure_item_code!=''">
                AND r.measure_item_code LIKE CONCAT('%',#{measure_item_code},'%')
            </if>
            <if test="thread_acceptance_criteria_no!=null and thread_acceptance_criteria_no!=''">
                AND r.thread_acceptance_criteria_no LIKE CONCAT('%',#{thread_acceptance_criteria_no},'%')
            </if>
        </where>
    </select>

    <select id="getAllByLike" resultType="map">
        select * from  dynamic_measurement_item r
        <where>
            <if test="measure_item_code!=null and measure_item_code!=''">
                AND r.measure_item_code LIKE CONCAT('%',#{measure_item_code},'%')
            </if>
            <if test="thread_acceptance_criteria_no!=null and thread_acceptance_criteria_no!=''">
                AND r.thread_acceptance_criteria_no LIKE CONCAT('%',#{thread_acceptance_criteria_no},'%')
            </if>
        </where>
        ORDER BY id DESC
        limit #{skip},#{take}
    </select>


    <select id="getDynamicMeasurementItemByAcceptanceCriteriaNo" resultType="com.spjzweb.entity.DynamicMeasurementItem">
        select * from  dynamic_measurement_item r
        <where>
            <if test="thread_acceptance_criteria_no!=null and thread_acceptance_criteria_no!=''">
                AND r.thread_acceptance_criteria_no =#{thread_acceptance_criteria_no}
            </if>
        </where>
    </select>
    <select id="getDataByItemCodeAndAcceptanceCriteriaNo" resultType="com.spjzweb.entity.DynamicMeasurementItem">
        select * from  dynamic_measurement_item r
        <where>
            <if test="thread_acceptance_criteria_no!=null and thread_acceptance_criteria_no!=''">
                AND r.thread_acceptance_criteria_no =#{thread_acceptance_criteria_no}
            </if>
            <if test="thread_acceptance_criteria_no!=null and thread_acceptance_criteria_no!=''">
                AND r.measure_item_code =#{measure_item_code}
            </if>
        </where>
    </select>



    <insert id="addDynamicMeasurementItem" parameterType="com.spjzweb.entity.DynamicMeasurementItem">
        INSERT INTO dynamic_measurement_item(measure_item_code,item_max_value,item_min_value,item_frequency,thread_acceptance_criteria_no) VALUES (#{measure_item_code},#{item_max_value},#{item_min_value},#{item_frequency},#{thread_acceptance_criteria_no})
    </insert>

    <update id="updateDynamicMeasurementItem" parameterType="com.spjzweb.entity.DynamicMeasurementItem">
        UPDATE dynamic_measurement_item set measure_item_code=#{measure_item_code},item_max_value=#{item_max_value},item_min_value=#{item_min_value},item_frequency=#{item_frequency},thread_acceptance_criteria_no=#{thread_acceptance_criteria_no} where id=#{id}
    </update>


    <delete id="delDynamicMeasurementItem">
        delete from dynamic_measurement_item WHERE
        <foreach collection="array" item="item" open="id in (" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <select id="getAllDropDownStaticMeasureItem" resultType="map">
        select s.measure_item_code,s.measure_item_name,s.measure_item_name_en from static_measurement_item s WHERE s.measure_item_code not in(
             SELECT d.measure_item_code from dynamic_measurement_item as d where d.thread_acceptance_criteria_no=#{thread_acceptance_criteria_no}
        )
    </select>
</mapper>